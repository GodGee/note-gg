### 微前端选择

##### 什么是微前端？

微前端的概念最早由 thoughtworks 在 2016 年提出。其核心思路是借鉴**后端微服务架构理念**，将一个单体的庞大的前端应用拆分为多个简单独立的前端工程。每个前端工程可以独立开发、测试、部署。最终再由一个容器应用，将拆分后的微前端工程组合为一个整体，面向用户提供服务。  微前端的架构方式所带来的好处也是显而易见的：

- **降低代码耦合，复杂度可控**: 每一个UI业务模块由独立的前端团队开发,避免代码巨无霸,保持开发时的高速编译,保持较低的复杂度,便于维护与开发效率。
- **独立部署**: 团队可以按照业务垂直拆分更高效，每一个模块可单独部署，颗粒度可小到单个组件的UI独立部署,不对其他模块有任何影响。
- **技术选型灵活**: 也是最具吸引力的,在同一项目下可以使用如今市面上所有前端技术栈,也包括未来的前端技术栈。
- **容错机制**: 单个模块发生错误,不影响全局。
- **可扩展性强**: 每一个服务可以独立横向扩展以满足业务伸缩性。

##### Why Not Iframe

为什么不用 `iframe`，这几乎是所有微前端方案第一个会被挑战的问题。但是大部分微前端方案又不约而同放弃了 `iframe` 方案，自然是有原因的，并不是为了 "炫技" 或者刻意追求 "特立独行"。

**如果不考虑体验问题，iframe 几乎是最完美的微前端解决方案了。**

iframe 最大的特性就是**提供了浏览器原生的硬隔离方案**，不论是样式隔离、js 隔离这类问题统统都能被完美解决。但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。比如：

1. URL 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
2. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程。
3. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。
4. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中。

其中有的问题比较好解决(问题1)，有的问题我们可以睁一只眼闭一只眼(问题2)，但有的问题我们则很难解决(问题3)甚至无法解决(问题4)，而这些无法解决的问题恰恰又会给产品带来非常严重的体验问题， 最终导致我们舍弃了 iframe 方案。



 